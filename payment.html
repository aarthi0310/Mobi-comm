<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobi-Comm | Payment</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .hero-gradient {
            background: linear-gradient(135deg, #1a365d 0%, #2563eb 100%);
        }
        .dropdown-menu {
            display: none;
            position: absolute;
            right: 0;
            top: 100%;
            background-color: white;
            min-width: 160px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            z-index: 50;
        }
        .dropdown-menu.show {
            display: block;
        }
        .plan-highlight {
            background-color: #f0f9ff;
            border-left: 4px solid #2563eb;
        }
        .payment-option:hover {
            background-color: #f0f7ff;
            border-color: #2563eb;
        }
        .payment-option.selected {
            background-color: #f0f7ff;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.5);
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-in-out;
        }
        .payment-form {
            display: none;
        }
        .payment-form.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        /* Responsive Adjustments */
        @media (max-width: 640px) { /* Mobile */
            .nav-links {
                display: none;
                flex-direction: column;
                width: 100%;
                position: absolute;
                top: 4rem;
                left: 0;
                background-color: white;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                padding: 0.5rem 0;
                z-index: 40;
            }
            .nav-links.show {
                display: flex;
            }
            .nav-links a, .nav-links .relative {
                padding: 0.75rem 1rem;
                width: 100%;
                text-align: left;
            }
            .dropdown-menu {
                position: static;
                width: 100%;
                box-shadow: none;
                border-radius: 0;
            }
            .hero-gradient {
                padding-top: 6rem;
                padding-bottom: 2rem;
            }
            .hero-gradient h1 {
                font-size: 1.5rem;
            }
            .hero-gradient p {
                font-size: 0.875rem;
            }
            #selected-plan-container, .p-6 {
                padding: 1rem;
            }
            #selected-plan-container h2 {
                font-size: 1.25rem;
            }
            .plan-highlight {
                padding: 1rem;
            }
            .payment-option {
                padding: 1rem;
            }
            .payment-option h3 {
                font-size: 1rem;
            }
            .payment-option p {
                font-size: 0.875rem;
            }
            .payment-form {
                padding: 1rem;
            }
            .payment-form h3 {
                font-size: 1rem;
            }
            .payment-form input, .payment-form select {
                font-size: 0.875rem;
            }
            .payment-form button {
                width: 100%;
                padding: 0.75rem;
            }
        }

        @media (min-width: 641px) and (max-width: 1023px) { /* Tablet */
            .nav-links {
                display: flex;
            }
            .mobile-menu-button {
                display: none;
            }
            .hero-gradient {
                padding-top: 7rem;
                padding-bottom: 2.5rem;
            }
            .hero-gradient h1 {
                font-size: 2rem;
            }
            .hero-gradient p {
                font-size: 1rem;
            }
            #selected-plan-container, .p-6 {
                padding: 1.5rem;
            }
            #selected-plan-container h2 {
                font-size: 1.5rem;
            }
            .payment-option {
                padding: 1.5rem;
            }
            .payment-form {
                padding: 1.5rem;
            }
            .payment-form h3 {
                font-size: 1.125rem;
            }
        }

        @media (min-width: 1024px) { /* Desktop */
            .mobile-menu-button {
                display: none;
            }
            .nav-links {
                display: flex;
            }
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- Navbar -->
    <nav class="bg-white shadow-lg fixed w-full z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <a href="index.html"><img src="network.webp" alt="Mobi-Comm Logo" class="h-8 w-8 mr-2"></a>
                    <a href="index.html"><span class="text-xl font-bold text-blue-600">Mobi-Comm</span></a>
                </div>
                <div class="flex items-center space-x-8 nav-links" id="navLinks">
                    <a href="index.html" class="text-gray-600 hover:text-blue-600 transition">Home</a>
                    <a href="plan1.html" class="text-gray-600 hover:text-blue-600 transition">Plans</a>
                    <a href="recharge.html" class="text-gray-600 hover:text-blue-600 transition">Recharge</a>
                    <a href="support.html" class="text-gray-600 hover:text-blue-600 transition">Support</a>
                    <div class="relative" id="accountDropdown">
                        <button class="flex items-center text-gray-600 hover:text-blue-600 transition" id="accountDropdownButton">
                            <img src="download.png" alt="Account" class="h-6 w-6 rounded-full">
                            <svg class="h-4 w-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                       
                    </div>
                </div>
                <!-- Mobile Menu Button -->
                <button class="mobile-menu-button md:hidden text-gray-600" id="mobileMenuButton">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
    </nav>
    
    <!-- Hero Section -->
    <div class="hero-gradient pt-28 pb-12 text-center text-white">
        <h1 class="text-4xl font-bold mb-2">Complete Your Payment</h1>
        <p class="text-lg opacity-90 max-w-2xl mx-auto px-4">
            Choose your preferred payment method to activate your plan
        </p>
    </div>

    <!-- Payment Content -->
    <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden mb-8">
            <!-- Selected Plan Section -->
            <div class="p-6 border-b" id="selected-plan-container">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Your Selected Plan</h2>
                <div class="plan-highlight p-4 rounded-md">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-gray-600 mb-1">Plan Name:</p>
                            <p class="font-medium text-gray-800 text-lg" id="selected-plan-name">Loading...</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">Price:</p>
                            <p class="font-bold text-blue-700 text-lg" id="selected-plan-price">Loading...</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">Data:</p>
                            <p class="font-medium text-gray-800" id="selected-plan-data">Loading...</p>
                        </div>
                        <div>
                            <p class="text-gray-600 mb-1">Validity:</p>
                            <p class="font-medium text-gray-800" id="selected-plan-validity">Loading...</p>
                        </div>
                    </div>
                    <div class="hidden" id="plan-id-container">
                        <p class="text-xs text-gray-500 mt-4">Plan ID: <span id="selected-plan-id"></span></p>
                    </div>
                </div>
            </div>
            
            <!-- Payment Methods Section -->
            <div class="p-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">Select Payment Method</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- UPI Option -->
                    <div class="payment-option border rounded-lg p-4 cursor-pointer transition-all duration-200" data-payment="upi">
                        <div class="flex items-center">
                            <div class="bg-blue-50 rounded-full p-3 mr-3">
                                <i class="fas fa-mobile-alt text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">UPI</h3>
                                <p class="text-sm text-gray-600">Pay via UPI apps</p>
                            </div>
                        </div>
                    </div>
                    <!-- Credit/Debit Card Option -->
                    <div class="payment-option border rounded-lg p-4 cursor-pointer transition-all duration-200" data-payment="card">
                        <div class="flex items-center">
                            <div class="bg-blue-50 rounded-full p-3 mr-3">
                                <i class="fas fa-credit-card text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Card</h3>
                                <p class="text-sm text-gray-600">Credit or Debit Card</p>
                            </div>
                        </div>
                    </div>
                    <!-- Net Banking Option -->
                    <div class="payment-option border rounded-lg p-4 cursor-pointer transition-all duration-200" data-payment="netbanking">
                        <div class="flex items-center">
                            <div class="bg-blue-50 rounded-full p-3 mr-3">
                                <i class="fas fa-university text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-medium">Net Banking</h3>
                                <p class="text-sm text-gray-600">All major banks</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- UPI Payment Form -->
                <div id="upiForm" class="payment-form rounded-lg border p-6 mb-6">
                    <h3 class="text-lg font-medium mb-4">Pay using UPI</h3>
                    <form id="upiPaymentForm">
                        <div class="mb-4">
                            <label for="upiId" class="block text-sm font-medium text-gray-700 mb-1">UPI ID</label>
                            <input type="text" id="upiId" name="upiId" placeholder="username@upi"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div class="flex items-center">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg transition">
                                Complete Payment
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Credit/Debit Card Payment Form -->
                <div id="cardForm" class="payment-form rounded-lg border p-6 mb-6">
                    <h3 class="text-lg font-medium mb-4">Pay using Credit/Debit Card</h3>
                    <form id="cardPaymentForm">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="cardNumber" class="block text-sm font-medium text-gray-700 mb-1">Card Number</label>
                                <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="cardName" class="block text-sm font-medium text-gray-700 mb-1">Name on Card</label>
                                <input type="text" id="cardName" name="cardName" placeholder="Vadivel"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label for="expiryDate" class="block text-sm font-medium text-gray-700 mb-1">Expiry Date</label>
                                <input type="text" id="expiryDate" name="expiryDate" placeholder="MM/YY"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label for="cvv" class="block text-sm font-medium text-gray-700 mb-1">CVV</label>
                                <input type="password" id="cvv" name="cvv" placeholder="310"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div class="flex items-center">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg transition">
                                Complete Payment
                            </button>
                        </div>
                    </form>
                </div>
    
                <!-- Net Banking Payment Form -->
                <div id="netbankingForm" class="payment-form rounded-lg border p-6 mb-6">
                    <h3 class="text-lg font-medium mb-4">Pay via Net Banking</h3>
                    <form id="netBankingPaymentForm">
                        <div class="mb-4">
                            <label for="bankName" class="block text-sm font-medium text-gray-700 mb-1">Select Bank</label>
                            <select id="bankName" name="bankName"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="icici">ICICI Bank</option>
                                <option value="hdfc">HDFC Bank</option>
                                <option value="axis">Axis Bank</option>
                                <option value="sbi">SBI</option>
                            </select>
                        </div>
                        <div class="flex items-center">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg transition">
                                Complete Payment
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Return to Plans -->
        <div class="text-center">
            <a href="plan1.html" class="text-blue-600 hover:text-blue-800 transition">
                <i class="fas fa-arrow-left mr-1"></i> Return to Plans
            </a>
        </div>
    </div>

    <script>
        // Navbar Functionality
        const accountDropdownButton = document.getElementById('accountDropdownButton');
        const dropdownMenu = document.getElementById('dropdownMenu');
        const mobileMenuButton = document.getElementById('mobileMenuButton');
        const navLinks = document.getElementById('navLinks');

        accountDropdownButton.addEventListener('click', (event) => {
            event.stopPropagation();
            dropdownMenu.classList.toggle('show');
        });

        mobileMenuButton.addEventListener('click', (event) => {
            event.stopPropagation();
            navLinks.classList.toggle('show');
        });

        window.addEventListener('click', (event) => {
            if (!accountDropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
                dropdownMenu.classList.remove('show');
            }
            if (!mobileMenuButton.contains(event.target) && !navLinks.contains(event.target)) {
                navLinks.classList.remove('show');
            }
        });

        // Utility Functions
        function showError(input, message) {
            let errorDiv = input.parentElement.querySelector('.error-message');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'error-message text-red-500 text-sm mt-1';
                input.parentElement.appendChild(errorDiv);
            }
            errorDiv.textContent = message;
            input.classList.add('border-red-500');
        }

        function removeError(input) {
            const errorDiv = input.parentElement.querySelector('.error-message');
            if (errorDiv) errorDiv.remove();
            input.classList.remove('border-red-500');
        }

        function isEmpty(value) {
            return value.trim() === '';
        }

        // Validation Functions
        function validateUPI(upiId) {
            return /^[a-zA-Z0-9._-]+@[a-zA-Z]{3,}$/.test(upiId);
        }

        function validateCard(cardNumber) {
            cardNumber = cardNumber.replace(/\s/g, '');
            return /^\d{16}$/.test(cardNumber);
        }

        function validateExpiry(expiry) {
            if (!/^\d{2}\/\d{2}$/.test(expiry)) return false;
            const [month, year] = expiry.split('/');
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear() % 100;
            const currentMonth = currentDate.getMonth() + 1;
            const numMonth = parseInt(month);
            const numYear = parseInt(year);
            if (numMonth < 1 || numMonth > 12) return false;
            if (numYear < currentYear || (numYear === currentYear && numMonth < currentMonth)) return false;
            return true;
        }

        // Formatting Functions
        function formatCard(value) {
            value = value.replace(/\D/g, '');
            value = value.replace(/(\d{4})/g, '$1 ');
            return value.trim();
        }

        function formatExpiry(value) {
            value = value.replace(/\D/g, '');
            if (value.length >= 2) {
                return value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            return value;
        }

        // Form Validation Setup
        function setupValidation() {
            const upiForm = document.getElementById('upiPaymentForm');
            if (upiForm) {
                const upiInput = document.getElementById('upiId');
                upiInput.onblur = () => {
                    if (isEmpty(upiInput.value)) showError(upiInput, 'UPI ID is required');
                    else if (!validateUPI(upiInput.value)) showError(upiInput, 'Enter valid UPI ID (example@upi)');
                };
                upiInput.oninput = () => removeError(upiInput);
                upiForm.onsubmit = (e) => {
                    e.preventDefault();
                    if (isEmpty(upiInput.value)) showError(upiInput, 'UPI ID is required');
                    else if (validateUPI(upiInput.value)) processPayment('UPI');
                };
            }

            const cardForm = document.getElementById('cardPaymentForm');
            if (cardForm) {
                const cardNumber = document.getElementById('cardNumber');
                const cardName = document.getElementById('cardName');
                const expiry = document.getElementById('expiryDate');
                const cvv = document.getElementById('cvv');

                cardNumber.oninput = () => { cardNumber.value = formatCard(cardNumber.value); removeError(cardNumber); };
                expiry.oninput = () => { expiry.value = formatExpiry(expiry.value); removeError(expiry); };
                cardName.oninput = () => removeError(cardName);
                cvv.oninput = () => removeError(cvv);

                cardNumber.onblur = () => {
                    if (isEmpty(cardNumber.value)) showError(cardNumber, 'Card number is required');
                    else if (!validateCard(cardNumber.value)) showError(cardNumber, 'Enter valid 16-digit card number');
                };
                cardName.onblur = () => {
                    if (isEmpty(cardName.value)) showError(cardName, 'Name on card is required');
                    else if (!/^[a-zA-Z\s]{3,}$/.test(cardName.value)) showError(cardName, 'Enter valid name (min 3 chars)');
                };
                expiry.onblur = () => {
                    if (isEmpty(expiry.value)) showError(expiry, 'Expiry date is required');
                    else if (!validateExpiry(expiry.value)) showError(expiry, 'Enter valid expiry date (MM/YY)');
                };
                cvv.onblur = () => {
                    if (isEmpty(cvv.value)) showError(cvv, 'CVV is required');
                    else if (!/^\d{3,4}$/.test(cvv.value)) showError(cvv, 'Enter valid CVV');
                };

                cardForm.onsubmit = (e) => {
                    e.preventDefault();
                    let isValid = true;
                    if (isEmpty(cardNumber.value)) { showError(cardNumber, 'Card number is required'); isValid = false; }
                    else if (!validateCard(cardNumber.value)) { showError(cardNumber, 'Enter valid 16-digit card number'); isValid = false; }
                    if (isEmpty(cardName.value)) { showError(cardName, 'Name on card is required'); isValid = false; }
                    else if (!/^[a-zA-Z\s]{3,}$/.test(cardName.value)) { showError(cardName, 'Enter valid name (min 3 chars)'); isValid = false; }
                    if (isEmpty(expiry.value)) { showError(expiry, 'Expiry date is required'); isValid = false; }
                    else if (!validateExpiry(expiry.value)) { showError(expiry, 'Enter valid expiry date (MM/YY)'); isValid = false; }
                    if (isEmpty(cvv.value)) { showError(cvv, 'CVV is required'); isValid = false; }
                    else if (!/^\d{3,4}$/.test(cvv.value)) { showError(cvv, 'Enter valid CVV'); isValid = false; }
                    if (isValid) processPayment('Card');
                };
            }

            const netBankingForm = document.getElementById('netBankingPaymentForm');
            if (netBankingForm) {
                const bankSelect = document.getElementById('bankName');
                bankSelect.onblur = () => { if (isEmpty(bankSelect.value)) showError(bankSelect, 'Please select a bank'); };
                bankSelect.onchange = () => removeError(bankSelect);
                netBankingForm.onsubmit = (e) => {
                    e.preventDefault();
                    if (isEmpty(bankSelect.value)) showError(bankSelect, 'Please select a bank');
                    else processPayment('NetBanking');
                };
            }
        }

        // Payment Method Selection
        document.querySelectorAll('.payment-option').forEach(option => {
            option.onclick = () => {
                document.querySelectorAll('.payment-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                document.querySelectorAll('.payment-form').forEach(form => form.classList.remove('active'));
                const paymentType = option.getAttribute('data-payment');
                document.getElementById(paymentType + 'Form').classList.add('active');
            };
        });

        // Process Payment
        function processPayment(method) {
            const plan = JSON.parse(sessionStorage.getItem('selectedPlan'));
            const payment = {
                planName: plan.name,
                amount: plan.price,
                method: method,
                transactionId: 'TX' + Date.now(),
                date: new Date().toLocaleString()
            };
            sessionStorage.setItem('paymentInfo', JSON.stringify(payment));
            window.location.href = 'payment conformation.html'; // Corrected typo in filename
        }

        // Load Selected Plan
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const plan = {
                name: urlParams.get('planName'),
                price: urlParams.get('price'),
                data: urlParams.get('data'),
                validity: urlParams.get('validity')
            };

            if (plan.name) {
                plan.id = 'PLAN_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('selectedPlan', JSON.stringify(plan));
            }

            const storedPlan = JSON.parse(sessionStorage.getItem('selectedPlan'));
            if (storedPlan) {
                document.getElementById('selected-plan-name').textContent = storedPlan.name;
                document.getElementById('selected-plan-price').textContent = storedPlan.price;
                document.getElementById('selected-plan-data').textContent = storedPlan.data;
                document.getElementById('selected-plan-validity').textContent = storedPlan.validity;
            } else {
                document.getElementById('selected-plan-container').innerHTML =
                    '<div class="p-4 bg-red-50 text-red-700">Please select a plan first</div>';
            }

            setupValidation();
            document.querySelector('.payment-option[data-payment="upi"]').click();
        };
    </script>
</body>
</html>